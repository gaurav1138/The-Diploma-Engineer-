<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Environmental Studies Quiz | The Diploma Engineer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="../assets/css/style.css">
</head>

<body>

<!-- ===== SIDEBAR ===== -->
<div id="sidebar" class="sidebar">
  <span class="close-btn" onclick="closeMenu()">‚úï</span>

  <h2>Menu</h2>
  <a href="index.html">Home</a>
  <a href="about.html">About</a>
  <a href="portfolio.html">Portfolio</a>
  <a href="notes.html">üìò Notes</a>
  <a href="evs-tests/tests.html">üß™ Environmental Studies Quiz</a>
  <a href="tool/tool.html">üß∞ Useful Tools</a>
  <a href="blog/blog.html">üìù Blog List</a>
  <a href="services.html">Services</a>
  <a href="contact.html">Contact</a>
</div>

<div id="overlay" onclick="closeMenu()"></div>

<div class="container">

<h1 id="testTitle">Environmental Studies Test</h1>

<!-- ===== EVS INFORMATION ===== -->
<div class="card">
  <h2>About Environmental Studies (EVS)</h2>
  <p>
    Environmental Studies is a compulsory subject for all Diploma
    Engineering branches. It helps students understand environmental
    issues, sustainability and human‚Äìnature relationship.
  </p>
  <ul>
    <li>üå± Pollution & control</li>
    <li>üåç Ecosystem & biodiversity</li>
    <li>‚ôª Sustainable development</li>
    <li>‚öñ Environmental laws & ethics</li>
  </ul>
</div>

<!-- ===== QUIZ BOX ===== -->
<div class="card" id="quizBox">
  <p id="timer">Time Left: 01:00:00</p>
  <p id="progress"></p>
  <h3 id="question">Loading...</h3>
  <div id="options"></div>

  <button class="btn" onclick="nextQ()">Next</button>
</div>

<!-- ===== RESULT ===== -->
<div class="card" id="resultBox" style="display:none;">
  <h2>Test Completed</h2>
  <p id="score"></p>
  <a href="tests.html" class="btn">Back to Tests</a>
</div>

</div>

<script>
// ===== LOAD TEST NUMBER =====
const testNo = new URLSearchParams(window.location.search).get("test");

document.getElementById("testTitle").innerText =
  "Environmental Studies Test ‚Äì " + testNo;

// ‚úÖ CORRECT CSV PATH (STRING)
const csvFile = `evs-tests/data/evs-test-${testNo}.csv`;

let questions = [];
let index = 0;
let answers = [];
let totalSeconds = 3600; // 1 hour

// ===== CSV PARSER (SAFE) =====
function parseCSV(text){
  const lines = text.trim().split(/\r?\n/);
  const data = [];

  for(let i = 1; i < lines.length; i++){
    const row = lines[i].split(",");

    if(row.length < 6) continue;
    if(!row[0]) continue;

    data.push({
      question: row[0].trim(),
      options: [
        row[1].trim(),
        row[2].trim(),
        row[3].trim(),
        row[4].trim()
      ],
      answer: parseInt(row[5].trim())
    });
  }
  return data;
}

// ===== LOAD CSV =====
fetch(csvFile)
  .then(res => {
    if(!res.ok) throw new Error("CSV not found");
    return res.text();
  })
  .then(text => {
    questions = parseCSV(text);
    startTimer();
    showQ();
  })
  .catch(err => {
    document.getElementById("question").innerText =
      "‚ùå CSV file load nahi ho rahi. Path check karo.";
    console.error(err);
  });

// ===== TIMER =====
function startTimer(){
  const interval = setInterval(()=>{
    totalSeconds--;

    let h = Math.floor(totalSeconds / 3600);
    let m = Math.floor((totalSeconds % 3600) / 60);
    let s = totalSeconds % 60;

    document.getElementById("timer").innerText =
      `Time Left: ${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;

    if(totalSeconds <= 0){
      clearInterval(interval);
      showResult();
    }
  },1000);
}

// ===== SHOW QUESTION =====
function showQ(){
  const q = questions[index];

  document.getElementById("progress").innerText =
    `Question ${index+1} of ${questions.length}`;

  document.getElementById("question").innerText = q.question;

  let html = "";
  q.options.forEach((opt,i)=>{
    html += `<div class="option" onclick="select(${i+1})">${opt}</div>`;
  });

  document.getElementById("options").innerHTML = html;
}

// ===== SELECT ANSWER =====
function select(choice){
  answers[index] = choice;
}

// ===== NEXT =====
function nextQ(){
  index++;
  if(index < questions.length) showQ();
  else showResult();
}

// ===== RESULT =====
function showResult(){
  let score = 0;
  questions.forEach((q,i)=>{
    if(answers[i] === q.answer) score++;
  });

  document.getElementById("quizBox").style.display = "none";
  document.getElementById("resultBox").style.display = "block";
  document.getElementById("score").innerText =
    `Score: ${score} / ${questions.length}`;
}
</script>
  
  <script src="../assets/js/main.js"></script>
  
</body>
</html>
