<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Environmental Studies Quiz | The Diploma Engineer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="../assets/css/style.css">
</head>

<body>

<!-- ===== SIDEBAR ===== -->
<div id="sidebar" class="sidebar">
  <span class="close-btn" onclick="closeMenu()">‚úï</span>

  <h2>Menu</h2>
  <a href="index.html">Home</a>
  <a href="about.html">About</a>
  <a href="portfolio.html">Portfolio</a>
  <a href="notes.html">üìò Notes</a>
  <a href="evs-tests/tests.html">üß™ Environmental Studies Quiz</a>
  <a href="tool/tool.html">üß∞ Useful Tools</a>
  <a href="blog/blog.html">üìù Blog List</a>
  <a href="services.html">Services</a>
  <a href="contact.html">Contact</a>
</div>

<div id="overlay" onclick="closeMenu()"></div>

  <script src="https://www.gstatic.com/charts/loader.js"></script>
</head>

<body>

<div class="container">

<!-- ===== TEST HEADING & INFO ===== -->
<div class="card">
  <h2>Environmental Studies ‚Äì Test 1</h2>

  <div class="info">
    <p><b>Total Questions:</b> 75</p>
    <p><b>Time Duration:</b> 1 Hour (60 Minutes)</p>
    <p><b>Instructions:</b></p>
    <ul>
      <li>Each question has 4 options</li>
      <li>Only one option is correct</li>
      <li>You can use Next & Previous buttons</li>
      <li>Questions appear in random order</li>
      <li>Final score will be shown after test completion</li>
    </ul>
  </div>
</div>

<!-- ===== STUDENT DETAILS ===== -->
<div class="card" id="studentBox">
  <h3>Start Test</h3>
  <input type="text" id="studentName" placeholder="Enter Student Name">
  <input type="text" id="rollNo" placeholder="Enter Roll Number">
  <button class="btn" onclick="startTest()">Start Test</button>
</div>

<!-- ===== TEST BOX ===== -->
<div class="card" id="testBox" style="display:none">
  <p class="timer" id="timer">Time Left: 60:00</p>
  <h3 id="question">Loading...</h3>
  <div id="options"></div>

  <div class="btn-group">
    <button class="btn" onclick="prevQ()">‚¨Ö Previous</button>
    <button class="btn" onclick="nextQ()">Next ‚û°</button>
  </div>
</div>

<!-- ===== RESULT ===== -->
<div class="card" id="resultBox" style="display:none">
  <h2>Advanced Score Card</h2>

  <p><b>Name:</b> <span id="rName"></span></p>
  <p><b>Roll No:</b> <span id="rRoll"></span></p>

  <hr>

  <p>Total Questions: <b id="rTotal"></b></p>
  <p>Attempted: <b id="rAttempted"></b></p>
  <p>Correct: <b id="rCorrect"></b></p>
  <p>Wrong: <b id="rWrong"></b></p>
  <p>Unattempted: <b id="rUnattempted"></b></p>
  <p>Percentage: <b id="rPercent"></b>%</p>
  <h3 id="rStatus"></h3>
</div>

<!-- ===== TEST LIST (BUTTONS) ===== -->
<div class="card">
  <h1>Environmental</h1>
  <h3>EVS Online Tests</h3>
  <a class="test-btn" href="evs-test.html?test=Test1">Start EVS Test 1</a>
  <a class="test-btn" href="evs-test.html?test=Test2">Start EVS Test 2</a>
  <a class="test-btn" href="evs-test.html?test=Test3">Start EVS Test 3</a>
  <a class="test-btn" href="evs-test.html?test=Test4">Start EVS Test 4</a>
  <a class="test-btn" href="evs-test.html?test=Test5">Start EVS Test 5</a>
  <a class="test-btn" href="evs-test.html?test=Test6">Start EVS Test 6</a>
  <a class="test-btn" href="evs-test.html?test=Test7">Start EVS Test 7</a>
  <a class="test-btn" href="evs-test.html?test=Test8">Start EVS Test 8</a>
  <a class="test-btn" href="evs-test.html?test=Test9">Start EVS Test 9</a>
  <a class="test-btn" href="evs-test.html?test=Test10">Start EVS Test 10</a>
</div>

</div>

<script>
google.charts.load("current",{packages:["table"]});

const SHEET_ID="17a82sn_wOH1uzskxG4OC9YV6Yveo7Ibb";
const urlParams=new URLSearchParams(window.location.search);
const TEST_NAME=urlParams.get("test")||"Test1";

let questions=[],current=0,answers=[];
let time=3600,timerInterval;
let sName="",sRoll="";

function startTest(){
  sName=document.getElementById("studentName").value.trim();
  sRoll=document.getElementById("rollNo").value.trim();
  if(!sName||!sRoll){alert("Enter Name & Roll Number");return;}
  document.getElementById("studentBox").style.display="none";
  document.getElementById("testBox").style.display="block";
  loadData();
}

function loadData(){
  questions=[]; current=0; answers=[];
  const query=new google.visualization.Query(
    `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${TEST_NAME}`
  );
  query.send(res=>{
    const d=res.getDataTable();
    for(let i=0;i<d.getNumberOfRows();i++){
      const q=d.getValue(i,0);
      if(!q) continue;
      questions.push([
        q,d.getValue(i,1),d.getValue(i,2),
        d.getValue(i,3),d.getValue(i,4),
        d.getValue(i,5)
      ]);
    }
    shuffle();
    startTimer();
    showQ();
  });
}

function shuffle(){
  for(let i=questions.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [questions[i],questions[j]]=[questions[j],questions[i]];
  }
}

function startTimer(){
  timerInterval=setInterval(()=>{
    time--;
    let m=Math.floor(time/60),s=time%60;
    document.getElementById("timer").innerText=`Time Left: ${m}:${s<10?"0"+s:s}`;
    if(time<=0)finish();
  },1000);
}

function showQ(){
  if(current>=questions.length){finish();return;}
  const q=questions[current];
  document.getElementById("question").innerText=`Q${current+1}. ${q[0]}`;
  let h="";
  for(let i=1;i<=4;i++){
    let c="";
    if(answers[current]){
      if(i==q[5])c="correct";
      else if(i==answers[current])c="wrong";
    }
    h+=`<div class="option ${c}" onclick="sel(${i})">${q[i]}</div>`;
  }
  document.getElementById("options").innerHTML=h;
}

function sel(i){answers[current]=i;showQ();}
function nextQ(){if(current<questions.length)current++;showQ();}
function prevQ(){if(current>0)current--;showQ();}

function finish(){
  clearInterval(timerInterval);
  let correct=0,attempted=0;
  for(let i=0;i<questions.length;i++){
    if(answers[i]){
      attempted++;
      if(answers[i]==questions[i][5])correct++;
    }
  }
  let wrong=attempted-correct;
  let unattempted=questions.length-attempted;
  let percent=Math.round((correct/questions.length)*100);

  document.getElementById("testBox").style.display="none";
  document.getElementById("resultBox").style.display="block";

  document.getElementById("rName").innerText=sName;
  document.getElementById("rRoll").innerText=sRoll;
  document.getElementById("rTotal").innerText=questions.length;
  document.getElementById("rAttempted").innerText=attempted;
  document.getElementById("rCorrect").innerText=correct;
  document.getElementById("rWrong").innerText=wrong;
  document.getElementById("rUnattempted").innerText=unattempted;
  document.getElementById("rPercent").innerText=percent;
  document.getElementById("rStatus").innerHTML=
    percent>=40?'<span class="pass">PASS ‚úÖ</span>':'<span class="fail">FAIL ‚ùå</span>';
}
</script>

</body>
</html>
